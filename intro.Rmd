---
title: "Intro to R Markdown"
output: 
  learnr::tutorial:
    css: "css/style.css"
    progressive: false
    allow_skip: true
runtime: shiny_prerendered
---

```{r setup, include=FALSE}
# Author: 
# Original Date: 
# Version of R: 

# See here for learnr package documentation: https://rstudio.github.io/learnr/

# Include packages here that are required throughout the training
library(learnr)         # Required to build the Shiny app
# library(gradethis)      # Required for specific code checking and specific feedback

knitr::opts_chunk$set(echo = FALSE)

# tutorial_options(
#   exercise.checker = gradethis::grade_learnr
# )
```

```{r phs-logo, fig.align='right', out.width="40%"}
knitr::include_graphics("images/phs-logo.png")
```

## Introduction

Welcome to an introduction to R Markdown. This course is designed as a self-led introduction to R Markdown for anyone in Public Health Scotland.

::: {.info_box}
<h4>

Course Info

</h4>

<ul>

<li>

This course is built to flow through sections and build on previous knowledge. If you're comfortable with a particular section, you can skip it.

</li>

<li>

Some sections have multiple parts to them. Navigate the course by using the buttons at the bottom of the screen to Continue or go to the Next Topic.

</li>

<li>

The course will also show progress through sections, a green tick will appear on sections you've completed, and it will remember your place if you decide to close your browser and come back later.

</li>

</ul>
:::

</br>

### What is R Markdown?

R Markdown provides an authoring framework for data science. You can use a single R Markdown file to

-   save and execute code
-   generate high quality reports that can be shared with an audience
-   make the report reproducible

R Markdown documents are fully reproducible and support dozens of static and dynamic output formats. This 1-minute video provides a quick tour of what's possible with R Markdown: ![](https://www.youtube.com/watch?v=HqrRdRrmatk)

### Knowledge Check

```{r intro-quiz}
quiz(
  question("Which of the following can R Markdown do?",
    answer("Generate reproducible reports", correct = TRUE),
    answer("Produce slides, dashboards, webpages, books", correct = TRUE),
    answer("Embed code chunks to save and execute code", correct = TRUE),
    incorrect = "Not quite, have another go!",
    allow_retry = TRUE,
    random_answer_order = TRUE
  )
)
```

## How it Works

### Open up an R Markdown File

To open an R Markdown file, go to *File \> New File \> R Markdown*. Give it a title you want. For the default output format, you can choose from HTML, PDF or Word, which will be the file type you want the report to be. If you choose Word and click OK, it will look like this - a plain text file has the extension .Rmd.

```{r howitworks, fig.align='center', out.width="100%"}
knitr::include_graphics("images/r-howitworks.png")
```

### Type of Content

An R Markdown file contains three type of content:

-   An (optional) YAML header surrounded by `---` s. In this section you have have information such as title, author, output format.

-   R code chunks surrounded by ```` ``` ```` s. In those chunks you can have R code you write in usual time.

-   text mixed with simple text formatting

## Code Chunks

As mentioned in the last section R code chunks can be embedded into an R Markdown file.

You can quickly insert chunks like these into your file with

-   the keyboard shortcut **Ctrl + Alt + I** (OS X: **Cmd + Option + I**)
-   the Add Chunk command in the editor toolbar or by typing the chunk delimiters ```` ```{r} and ``` ````.

When you render your .Rmd file, R Markdown will run each code chunk and embed the results beneath the code chunk in your final report.

### Chunk Options

Chunk output can be customized with arguments set in the `{}` of a chunk header. These are the commonly used arguments:

-   `include = FALSE` prevents code and results from appearing in the finished file. R Markdown still runs the code in the chunk, and the results can be used by other chunks.
-   `echo = FALSE` prevents code, but not the results from appearing in the finished file. This is a useful way to embed figures.
-   `message = FALSE` prevents messages that are generated by code from appearing in the finished file.
-   `warning = FALSE` prevents warnings that are generated by code from appearing in the finished.
-   `fig.cap = "..."` adds a caption to graphical results.

### Global Options

To set global options that apply to every chunk in your file, call `knitr::opts_chunk$set` in a code chunk. Knitr will treat each option that you pass to `knitr::opts_chunk$set` as a global default, however this can also be overwritten in individual chunk headers.

## Inline Code

Sometimes you may want to calculate a figure (e.g. number of cases) using R code and embed this figure in a paragraph. So code results can be inserted directly into the text by enclosing the code with `` `r ` ``.

Here is an example by using Borders(Age) dataset to calculate number of cases according to gender:

```{r inlinecode, fig.align='center', out.width="100%"}
knitr::include_graphics("images/r-inlinecode.png")
```

Gender is a parameter which will be discussed in the next chapter. As you can see the number of cases is calculated and assigned to "cases". Then it is called in the statement "There are `` `r "\u0060r cases\u0060"` `` records in the dataset". This makes the report reproducible as when the dataset is updated this figure will always be re-calculated automatically.

R Markdown will always

-   display the results of inline code, but not the code
-   apply relevant text formatting to the results

As a result, inline output is indistinguishable from the surrounding text. Inline expressions do not take knitr options.

## Parameters

R Markdown documents can include one or more parameters whose values can be set when you render the report. This creates convenience when you want to quickly create the same report with distinct values for various key inputs, such as

-   Running a report specific to a department or geographic region (e.g. Health Board).

-   Running a report that covers a specific period in time.

-   Running multiple versions of a report for distinct sets of core assumptions.

Here is an example of producing a data report using Borders(Age) dataset. We can quickly generate the report based on selecting male or female.

```{r parameters, fig.align='center', out.width="100%"}
knitr::include_graphics("images/r-parameters.png")
knitr::include_graphics("images/r-parameters-word.png")
```

### Declaring Parameters

Parameters are declared using the params field within the YAML header of the document. The example above creates the parameter data and assigns it with the label "Gender" and default value "Male".

### Using Parameters in Code

To access a parameter in code, call `params$<parameter name>`. The example above used `sum(Borders_age$Sex == params$gender, na.rm = TRUE)` to calculate the number of cases based on the gender selected.

### Knit with Parameters

To produce the report with parameters, simply click the "Knit with Parameters" option in the dropdown menu next to the RStudio knit button to set parameters.

```{r parameters-knit, fig.align='center', out.width="70%"}
knitr::include_graphics("images/r-parameters-knit.png")
knitr::include_graphics("images/r-parameters-knit2.png")
```

## Tables

Sometimes you would like to embed tables such as data tables in your report. Generally using `knitr::kable` function or the package flextable are the good ways to present tables with additional formatting.

### Using Kable Function

Here is an example of showing the first 5 rows in the Borders(Age) dataset by selecting a gender:

```{r tables-kable1, fig.align='center', out.width="100%"}
knitr::include_graphics("images/r-tables-kable1.png")
```

The table is displayed like this:

```{r tables-kable2, fig.align='center', out.width="100%"}
knitr::include_graphics("images/r-tables-kable2.png")
```

### Using Flextable

A package called flextable provides more options for table formatting such as alignment and filled colour of cells. Here is an example of displaying the above table with more fancy formatting (officer package is used for adding border lines):

```{r tables-flextable1, fig.align='center', out.width="100%"}
knitr::include_graphics("images/r-tables-flextable1.png")
```

The table is displayed with more features like this:

```{r tables-flextable2, fig.align='center', out.width="100%"}
knitr::include_graphics("images/r-tables-flextable2.png")
```

## Markdown Basics

### Format Text

You can format the text in your R Markdown file with [Pandoc's Markdown](https://rmarkdown.rstudio.com/authoring_pandoc_markdown.html), a set of markup annotations for plain text files. For example, using \*\* at the beginning and end of a statement to make it bold. More about the format text please refer to the [R Markdown Cheatsheet](https://www.rstudio.com/wp-content/uploads/2016/03/rmarkdown-cheatsheet-2.0.pdf?_ga=2.84009817.1909559413.1615196547-221181954.1612528976).

### Visual Markdown Editor

In the latest version of RStudio you can also edit the text format by switching to visual markdown editor mode. It has user friendly interface to edit the text in the document, just like MS Word. Click "A" on the toolbar to switch. You can come back to the source editor by pressing the same button and see the source code contain the changes you just edited.

```{r markdowneditor, fig.align='center', out.width="50%"}
knitr::include_graphics("images/r-markdowneditor.png")
```

## Output Formats

As mentioned earlier when render the document you can choose to knit to different formats such as HTML, PDF, MS Word. You can define it in YAML and also do it by clicking the dropdown menu next to the knit button:

```{r outputformats, fig.align='center', out.width="50%"}
knitr::include_graphics("images/r-outputformats.png")
```

There are a range of output formats available to use with R Markdown:

Documents

-   [html_notebook](https://bookdown.org/yihui/rmarkdown/notebook.html) - Interactive R Notebooks

-   [html_document](https://bookdown.org/yihui/rmarkdown/html-document.html) - HTML document w/ Bootstrap CSS

-   [pdf_document](https://bookdown.org/yihui/rmarkdown/pdf-document.html) - PDF document (via LaTeX template)

-   [word_document](https://bookdown.org/yihui/rmarkdown/word-document.html) - Microsoft Word document (docx)

-   [md_document](https://bookdown.org/yihui/rmarkdown/markdown-document.html) - Markdown document (various flavors)

Presentations (Slides)

-   [ioslides_presentation](https://bookdown.org/yihui/rmarkdown/ioslides-presentation.html) - HTML presentation with ioslide

-   [powerpoint_presentation](https://bookdown.org/yihui/rmarkdown/powerpoint-presentation.html): PowerPoint presentation

More

-   [flexdashboard::flex_dashboard](https://rmarkdown.rstudio.com/flexdashboard/) - Interactive dashboards

-   [html_vignette](https://bookdown.org/yihui/rmarkdown/r-package-vignette.html) - R package vignette (HTML)

-   [github_document](https://rmarkdown.rstudio.com/github_document_format.html) - GitHub Flavored Markdown document

## PHS Publication Template

Public Health Scotland (PHS) has R Markdown templates for publication summary and report. You can find it at [PHS GitHub repository](https://github.com/Public-Health-Scotland/National-Stats-Template) with instructions. They have also been included in the [phstemplates](https://github.com/Public-Health-Scotland/phstemplates) package.

## Cheatsheets

Use the cheatsheets that are built into the RStudio IDE to jog your memory about R Markdown.

```{r cheatsheet1, fig.align='center', out.width="100%"}
knitr::include_graphics("images/r-cheatsheet1.png")
```

Go to *Help \> Cheatsheets \> R Markdown Cheat Sheet* to open the main [R Markdown cheatsheet](https://github.com/rstudio/cheatsheets/raw/master/rmarkdown-2.0.pdf), pictured above.

```{r cheatsheet2, fig.align='center', out.width="100%"}
knitr::include_graphics("images/r-cheatsheet2.png")
```

Go to *Help \> Markdown Quick Reference* to open the *Markdown Quick Reference* in your help pane.

```{r cheatsheet3, fig.align='center', out.width="100%"}
knitr::include_graphics("images/r-cheatsheet3.png")
```

